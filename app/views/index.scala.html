@(entries: List[models.Entry],
sortedItems: List[models.DisplayItem],
selectedBook: Option[(models.Entry, models.DisplayItem)] = None,
notes: Seq[models.Note] = Seq.empty,
username: Option[String] = None,
filters: Map[String, String] = Map.empty)(implicit request: play.api.mvc.RequestHeader)

@import viewmodels.CoverResolver
@import java.time.format.DateTimeFormatter

@defining(DateTimeFormatter.ofPattern("dd-MM-yyyy")){ dateFormatter =>

@main("Strona główna") {
<style>
    body {
        background-color: #F8FAFC; 
    }

    .green-background-panel {
        background-color: #4A9782;
        padding: 20px;
        border-radius: 4px;
        min-height: 450px;
        color: white;
    }

    .login-btn {
        padding: 0.5rem 1.5rem;
        color: #4A9782;
        border: 2px solid #4A9782;
        font-weight: 600;
        border-radius: 50rem;
        background-color: transparent;
        transition: all 0.3s;
        text-decoration: none;
        display: inline-block;
    }
    
    .login-btn:hover {
        background-color: #4A9782;
        color: white;
    }

    .logout-btn {
        padding: 0.5rem 1.5rem;
        color: #B3170C;
        border: 2px solid #B3170C;
        font-weight: 600;
        border-radius: 50rem;
        background-color: transparent;
        transition: all 0.3s;
        text-decoration: none;
        display: inline-block;
        margin-left: 1rem;
    }

    .logout-btn:hover {
        background-color: #B3170C;
        color: white;
    }

    .add-book-btn {
        padding: 0.5rem 1.1rem;
        color: white;
        border: 2px solid black;
        font-weight: 600;
        border-radius: 50rem;
        background-color: black;
        transition: all 0.3s;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        margin-left: 1rem;
    }

    .add-book-btn .icon-plus {
        width: 19px;
        height: 19px;
        display: block;
        fill: currentColor;
        flex-shrink: 0;
    }

    .add-book-btn:hover {
        background-color: transparent;
        color: black;
    }

    .book-button {
        display: block;
        width: 100%;
        padding: 14px 16px;
        border-radius: 6px;
        color: white;
        text-decoration: none;
        transition: background-color 0.2s ease;
        margin: 10px auto;
    }

    .book-button:hover {
        background-color: rgba(255, 255, 255, 0.15);
        color: white;
    }

    .book-button.active {
        background-color: rgba(255, 255, 255, 0.25);
    }

    .book-author {
        font-size: 0.85rem;
        opacity: 0.85;
    }
</style>

<div class="container mt-4">
    @* Sekcja użytkownika *@
    <div class="d-flex justify-content-between align-items-center mb-3">

        <div>
            @username.map { name =>
            <div class="d-flex flex-column align-items-start gap-2">
                <a href="@routes.NoteController.showNotes" class="add-book-btn btn-sm">
                    <i class="bi bi-plus-lg"></i> Moje notatki
                </a>

                <a href="@routes.HomeController.drawToReadBook" class="add-book-btn btn-sm mt-1">
                    <i class="bi bi-plus-lg"></i> Losuj
                </a>
            </div>
            }
        </div>

        <div>
            @username.map { name =>
            <div class="d-flex flex-column align-items-end gap-2">
                <span>Witaj, <strong>@name</strong>!</span>
                <a href="@routes.AuthController.logout()" class="logout-btn btn-sm">Wyloguj się</a>
            </div>
            }.getOrElse {
            <a href="@routes.AuthController.loginPage()" class="login-btn btn-sm">Zaloguj się</a>
            }
        </div>

    </div>


    @* Nagłówek strony *@
    <div class="text-center mb-5">
        <h1 class="display-3 d-flex align-items-center justify-content-center">
            <img src="@routes.Assets.versioned("images/bookworm.png")"
            alt="Bugshelv Icon"
            style="height: 1em; width: auto;"
            class="me-3">
            Bugshelv
        </h1>
        <div class="mt-4">
            <a href="@routes.HomeController.addBook()" class="add-book-btn d-inline-flex align-items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg"
                     viewBox="0 0 24 24"
                     class="icon-plus"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M11.25 12.75V18H12.75V12.75H18V11.25H12.75V6H11.25V11.25H6V12.75H11.25Z"/>
                </svg>
                Dodaj książkę
            </a>

            <a href="@routes.HomeController.addPublication()" class="add-book-btn d-inline-flex align-items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg"
                     viewBox="0 0 24 24"
                     class="icon-plus"
                     aria-hidden="true">
                    <path fill-rule="evenodd"
                        clip-rule="evenodd"
                        d="M11.25 12.75V18H12.75V12.75H18V11.25H12.75V6H11.25V11.25H6V12.75H11.25Z"/>
                </svg>
                Dodaj publikację
            </a>
        </div>

    </div>

    @* Główna zawartość *@
    <div class="row align-items-stretch">
        @* LEWA KOLUMNA *@
        <div class="col-md-7 d-flex flex-column">
            <div class="green-background-panel h-100">
            @* Filtry POWYŻEJ kontenera *@
            @if(entries.nonEmpty || filters.nonEmpty) {
            <div class="d-flex align-items-center gap-2 mb-4">
                <div class="search-bar">
                    <form method="GET"
                          action="@routes.HomeController.index()"
                          class="d-flex align-items-center gap-2">

                        <input
                                type="search"
                                name="search"
                                class="form-control form-control-sm"
                                placeholder="Szukaj…"
                                value="@filters.getOrElse("search", "")"
                                style="width: 300px"
                        />

                        @for((key, value) <- filters if key != "search") {
                        <input type="hidden" name="@key" value="@value" />
                        }
                        <!-- <button class="btn btn-outline-secondary btn-sm" type="submit">
                            ⌕
                        </button> -->
                    </form>
                </div>
                <div class="dropdown ms-auto">
                    <button class="btn btn-light btn-sm dropdown-toggle shadow-sm" type="button" data-bs-toggle="dropdown">
                        Filtruj według statusu
                    </button>
                    <ul class="dropdown-menu">
                        @defining(List(
                        ("all", "Wszystkie"),
                        ("to_read", "Planowane"),
                        ("reading", "Czytane"),
                        ("finished", "Przeczytane"),
                        ("dropped", "Porzucone")
                        )) { statuses =>
                        @for((statusParam, label) <- statuses) {
                        @defining(if (statusParam == "all") filters - "status" else filters + ("status" -> statusParam)) { queryMap =>
                        <li>
                            <a class="dropdown-item @if(filters.get("status").contains(statusParam)) { active }"
                            href="@(routes.HomeController.index().url + (if (queryMap.nonEmpty) "?" + queryMap.map { case (k,v) => k + "=" + v }.mkString("&") else ""))">
                            @label
                            </a>
                        </li>
                        }
                        }
                        }
                    </ul>
                </div>

                <div class="dropdown">
                    <button class="btn btn-light btn-sm dropdown-toggle shadow-sm" type="button" data-bs-toggle="dropdown">
                        Sortuj
                    </button>
                    <ul class="dropdown-menu">
                        @defining(List(
                        ("title_asc", "Tytuł ↑"), ("title_desc", "Tytuł ↓"),
                        ("author_asc", "Autor ↑"), ("author_desc", "Autor ↓"),
                        ("year_asc", "Rok ↑"), ("year_desc", "Rok ↓")
                        )) { sortOptions =>
                        @for((sortParam, label) <- sortOptions) {
                        @defining(filters + ("sort" -> sortParam)) { queryMap =>
                        <li>
                            <a class="dropdown-item @if(filters.get("sort").contains(sortParam)) { active }"
                            href="@(routes.HomeController.index().url + "?" + queryMap.map { case (k,v) => k + "=" + v }.mkString("&"))">
                            @label
                            </a>
                        </li>
                        }
                        }
                        }
                    </ul>
                </div>
            </div>

            }

            @* Zielony kontener z książkami *@
            <div class="d-flex flex-column align-items-center">
                @if(entries.isEmpty) {
                <p>Brak książek.</p>
                } else {
                @for(entry <- entries) {
                @defining(sortedItems.find(_.id == entry.refId)) { itemOpt =>
                @defining(
                routes.HomeController.showBook(entry.refId).url +
                (if (filters.nonEmpty) "?" + filters.map { case (k,v) => k + "=" + v }.mkString("&") else "")
                ) { bookUrl =>
                <a href="@bookUrl" class="book-button @if(selectedBook.exists(_._1.refId == entry.refId)) { active }">
                    @itemOpt.map { item =>
                    <strong>@item.title</strong><br>
                    <span class="book-author">
                        @{
                            item match {
                                case b: models.Book => b.author
                                case p: models.Publication => p.authors
                            }
                        }
                    </span>
                    }.getOrElse {
                    <em>Nieznana książka (ISBN: @entry.refId)</em>
                    }
                </a>
                }
                }
                }
                }
            </div>
        </div>
            </div>

        @* prawa kolumna *@
        <div class="col-md-5 d-flex flex-column">
            <div class="green-background-panel h-100 ">
                @selectedBook.map { case (entry, item) =>
                <div class="row mb-3">
                    <div class="col-6">
                        <img src="@CoverResolver.resolve(entry, item)" 
                             class="img-fluid rounded shadow w-100 h-100" 
                             style="max-height: 300px; object-fit: contain;">
                    </div>
                    <div class="col-6">
                        <div class="mb-3 text-end">
                            <a href="@routes.HomeController.deleteBook(entry.id)" class="btn btn-light btn-sm shadow-sm me-2">
                                <img src="@routes.Assets.versioned("images/trash-icon.svg")" alt="Usuń" style="height: 20px; width: auto;">
                            </a>
                            <a href="@routes.HomeController.editBookEntry(entry.id)" class="btn btn-light btn-sm shadow-sm">
                                <img src="@routes.Assets.versioned("images/edit-icon.svg")" alt="Edytuj" style="height: 20px; width: auto;">
                            </a>
                        </div>
                        <h3>@item.title</h3>
                        <p><strong>Autor: </strong>@{
                            item match {
                                case b: models.Book => b.author
                                case p: models.Publication => p.authors
                            }
                        }</p>
                        <p><strong>Status:</strong> @entry.status</p>
                        <p><strong>Strony:</strong> @entry.pagesRead / @{
                            item match {
                                case b: models.Book => if (b.pages == 0) "?" else b.pages.toString
                                case p: models.Publication => p.pageCount.toString
                            }
                        }</p>
                    </div>
                </div>

                <hr>
                <h4>Notatki</h4>
                @if(notes.isEmpty) {
                <p>Brak notatek.</p>
                } else {
                @for(note <- notes) {
                <div class="note-card mb-2 p-2 border rounded text-dark bg-light">
                    <strong>@note.title</strong>
                    <p class="mb-1">@note.content</p>
                    <div class="mt-1">
                        <a href="@routes.NoteController.edit(note.id)" class="btn btn-sm btn-link p-0">Edytuj</a>
                        <form action="@routes.NoteController.delete(note.id)" method="POST" style="display:inline;">
                            @helper.CSRF.formField
                            <button type="submit" class="btn btn-sm btn-link text-danger p-0 ms-2">Usuń</button>
                        </form>
                    </div>
                </div>
                }
                }
                <a href="@routes.NoteController.add(entry.id)" class="btn btn-success btn-sm mt-2">Dodaj notatkę</a>

                }.getOrElse {
                <p>Wybierz książkę z listy, aby zobaczyć szczegóły.</p>
                }
            </div>
        </div>
    </div>
</div>
}
}
<br>
<br>