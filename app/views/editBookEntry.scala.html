@(entry: models.Entry,
  book: models.Book,
  username: Option[String] = None)(implicit request: play.api.mvc.RequestHeader)

@import viewmodels.CoverResolver

@main(book.title) {

<style>
  .green-background-panel {
    background-color: #4A9782;
    padding: 24px;
    border-radius: 6px;
    color: white;
  }

  .book-cover img {
    max-height: 400px;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }

  .book-info p {
    font-size: 1.1rem;
  }

  details summary {
    cursor: pointer;
    font-weight: bold;
  }

  details summary:hover {
    text-decoration: underline;
  }
</style>

<div class="container mt-4">
  <!-- User bar -->
  <div class="d-flex justify-content-end mb-3">
    @username.map { name =>
      <div>
        Witaj, <strong>@name</strong>!
        <a href="@routes.AuthController.logout()"
           class="btn btn-outline-danger btn-sm ms-2">Wyloguj się</a>
      </div>
    }.getOrElse {
      <a href="@routes.AuthController.loginPage()"
         class="btn btn-outline-primary btn-sm">Zaloguj się</a>
    }
  </div>

  <!-- Back button -->
  <div class="mb-3">
    <a href="@routes.HomeController.index()" class="btn btn-light">
      ← Powrót do listy książek
    </a>
  </div>

  <div class="green-background-panel row">

    <!-- Cover -->
    <div class="col-md-5 text-center book-cover">
      @if(entry.altCover.nonEmpty || book.cover.nonEmpty) {
        <img src="@CoverResolver.resolve(entry, book)"
             alt="Okładka książki"
             class="img-fluid mb-3">

        <!-- Upload new cover -->
        <form action="@routes.EntryController.editBookCover(entry.id)"
              method="POST" enctype="multipart/form-data"
              class="mt-2">

            @helper.CSRF.formField

            <input type="file"
                   name="cover"
                   accept="image/*"
                   class="form-control mb-2"
                   required>

            <button type="submit" class="btn btn-primary btn-sm">Zmień okładkę</button>
        </form>

        }
    </div>

    <!-- Info -->
    <div class="col-md-7 book-info">
      <h1>@book.title</h1>

      <p><strong>Autor:</strong> @book.author</p>
      <p><strong>ISBN:</strong> @book.isbn</p>

        <!-- Year of publishing -->
        @if(book.publishYear == 0) {
            <details class="mb-3">
                <summary>
                    Rok publikacji: Do uzupełnienia ✏️
                </summary>

                <form action="@routes.EntryController.updateBookYear(entry.id)"
                      method="POST"
                      class="mt-2">

                    @helper.CSRF.formField

                    <input type="number"
                           name="publishYear"
                           min="0"
                           max="@java.time.Year.now.getValue"
                           value="@book.publishYear"
                           class="form-control mb-2"
                           required>

                    <button class="btn btn-success btn-sm">Zapisz</button>
                </form>
            </details>
        } else {
        <p><strong>Rok publikacji:</strong> @book.publishYear</p>
        }

        <!-- Pages in the book -->
        @if(book.pages == 0) {
            <details class="mb-3">
                <summary>
                    Liczba stron: Do uzupełnienia ✏️
                </summary>

                <form action="@routes.EntryController.updateBookPages(entry.id)"
                      method="POST"
                      class="mt-2">

                    @helper.CSRF.formField

                    <input type="number"
                           name="pages"
                           min="0"
                           max="5000"
                           value="@book.pages"
                           class="form-control mb-2"
                           required>

                    <button class="btn btn-success btn-sm">Zapisz</button>
                </form>
            </details>
        } else {
        <p><strong>Liczba stron:</strong> @book.pages</p>
        }

      <!-- Pages read (NO JS) -->
      <details class="mb-3">
        <summary>
          Przeczytane strony: @entry.pagesRead ✏️
        </summary>

        <form action="@routes.EntryController.updatePagesRead(entry.id)"
              method="POST"
              class="mt-2">

          @helper.CSRF.formField

          <input type="number"
                 name="pagesRead"
                 min="0"
                 max="@book.pages"
                 value="@entry.pagesRead"
                 class="form-control mb-2"
                 required>

          <button class="btn btn-success btn-sm">Zapisz</button>
        </form>
      </details>

      <!-- Status -->
      <details class="mb-3">
        <summary>
          Status: @entry.status ✏️
        </summary>

        <form action="@routes.EntryController.updateStatus(entry.id)"
              method="POST"
              class="mt-2">

          @helper.CSRF.formField

          <select name="status" class="form-select mb-2">
            <option value="to_read"
              @if(entry.status == models.BookStatus.ToRead) { selected }>
              Do przeczytania
            </option>

            <option value="reading"
              @if(entry.status == models.BookStatus.Reading) { selected }>
              Czytam
            </option>
            
            <option value="dropped"
              @if(entry.status == models.BookStatus.Dropped) { selected }>
              Porzucona
            </option>

            <option value="finished"
              @if(entry.status == models.BookStatus.Finished) { selected }>
              Przeczytana
            </option>
          </select>

            @if(entry.status == models.BookStatus.Finished) {
            <div class="mb-2">
                <label class="form-label">Data przeczytania</label>
                <input
                        type="date"
                        name="finishedAt"
                        value="@{ entry.finishedAt.fold("")(_.toString) }"
                class="form-control"
                />
            </div>
            }

          <button class="btn btn-success btn-sm">Zapisz</button>
        </form>
      </details>

      <!-- Delete -->
      <form action="@routes.HomeController.deleteBook(entry.id)"
            method="POST"
            class="mt-3">

        @helper.CSRF.formField

        <button class="btn btn-danger">
          Usuń książkę
        </button>
      </form>

    </div>
  </div>
</div>
}
